network gen_ent_7 {
  in  u1  i_0;
  in  u2  i_1;
  in  u3  i_2;
  in  u4  i_3;

  out u1  o_0;
  out u2  o_1;
  out u3  o_2;
  out u4  o_3;

  network connect {
    param uint W;

    in  uint(W) p_i;
    out uint(W) p_o;

    new fsm nested {
      in       uint(W) p_ii;
      out wire uint(W) p_oo;
      void main() {
        uint(W) t = p_ii;
        gen for (uint n < 2*W) {
          t = ~t;
        }
        p_oo = t;
        fence;
      }
    }

    p_i -> nested.p_ii; nested.p_oo -> p_o;
  }

  gen for (uint n <= 3) {
    inst = new connect(W = n + 1);

    gen if (n == 0) {
      i_0 -> inst.p_i; inst.p_o -> o_0;
    } else if (n == 1) {
      i_1 -> inst.p_i; inst.p_o -> o_1;
    } else if (n == 2) {
      i_2 -> inst.p_i; inst.p_o -> o_2;
    } else {
      i_3 -> inst.p_i; inst.p_o -> o_3;
    }
  }
}

